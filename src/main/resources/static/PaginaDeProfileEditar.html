<!DOCTYPE html>
<html data-bs-theme="light" lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Editar Perfil - TechFree</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/bs-theme-overrides.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,600,700,800&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Azeret+Mono:400,700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:400,700,900&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        main, section.bg-dark {
            /*background: #00294B !important;*/
            min-height: 100vh;
        }
        .profile-header {
            background: rgba(0,0,0,0.18);
            color: #fff;
            border-radius: 1.5rem;
            padding: 2.5rem 2rem 2rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 24px rgba(0,0,0,0.10);
            display: flex;
            align-items: center;
            gap: 2rem;
            justify-content: space-between;
        }
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #FF6F00;
            background: #fff;
        }
        .profile-info h2 {
            color: #fff;
            font-weight: 800;
            margin-bottom: 0.3rem;
        }
        .profile-info .role {
            color: #FF6F00;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .profile-info .location {
            color: #bdbdbd;
            font-size: 1rem;
        }
        .profile-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem 0.5rem; /* Espaço entre badges na horizontal e vertical */
        }
        .profile-badges .badge {
            background: #FF6F00;
            color: #fff;
            margin-right: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
        }
        .profile-section {
            background: rgba(255,255,255,0.07);
            color: #fff;
            border-radius: 1.2rem;
            box-shadow: 0 2px 16px rgba(0,0,0,0.06);
            padding: 2rem 2rem 1.5rem 2rem;
            margin-bottom: 2rem;
        }
        .profile-section h4 {
            color: #fff;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        .profile-section ul {
            padding-left: 1.2rem;
        }
        .invite-card {
            background: rgba(255,255,255,0.10);
            border-radius: 1.2rem;
            padding: 2rem 2rem 1.5rem 2rem;
            color: #fff;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
        }
        .invite-card h5 {
            color: #fff;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        .invite-card select {
            background: #22243a;
            color: #fff;
            border: 1px solid #44495a;
            border-radius: 0.5rem;
        }
        .invite-card select:focus {
            background: #22243a;
            color: #fff;
            border-color: #FF6F00;
        }
        .invite-btn {
            background: #FF6F00;
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 2.5rem;
            margin-top: 1rem;
            transition: background 0.2s;
        }
        .invite-btn:hover {
            background: #ff8c33;
            color: #fff;
        }
        .profile-contact i {
            color: #FF6F00;
            margin-right: 0.5rem;
        }
        .profile-contact span {
            color: #fff;
        }
        .profile-social a {
            color: #fff;
            margin-right: 1rem;
            font-size: 1.4rem;
            transition: color 0.2s;
        }
        .profile-social a:hover {
            color: #FF6F00;
        }
        .profile-timeline {
            border-left: 3px solid #FF6F00;
            padding-left: 1.5rem;
            margin-left: 0.5rem;
        }
        .profile-timeline .timeline-item {
            margin-bottom: 1.5rem;
        }
        .profile-timeline .timeline-item:last-child {
            margin-bottom: 0;
        }
        .timeline-title {
            font-weight: 700;
            color: #FF6F00;
        }
        .timeline-period {
            font-size: 0.95rem;
            color: #bdbdbd;
        }
        .profile-certificates .badge {
            background: #fff;
            color: #00294B;
            margin-right: 0.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            border: 1px solid #FF6F00;
        }
        .feedback-overlay {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(20, 23, 34, 0.82);
            transition: opacity 0.2s;
        }
        .feedback-overlay.active {
            display: block;
        }
        .feedback-form-card {
            background: #22243a;
            color: #fff;
            border-radius: 1.2rem;
            box-shadow: 0 4px 32px rgba(0,0,0,0.20);
            padding: 2.5rem 2rem 2rem 2rem;
            width: 600px;
            max-width: 95vw;
            max-height: 90vh;      /* Limita a altura máxima do popup */
            overflow-y: auto;      /* Adiciona rolagem interna se necessário */
            margin: 0 auto;
            position: fixed;
            left: 50%;
            top: 50%;
            z-index: 1100;
            transform: translate(-50%, -50%);
            display: none;
            animation: fadeInScale 0.2s;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: translate(-50%, -40%) scale(0.95);}
            to { opacity: 1; transform: translate(-50%, -50%) scale(1);}
        }
        .form-label {
            color: #fff;
            font-weight: 700;
        }
        .form-control, .form-select {
            background: #22243a;
            color: #fff;
            border: 1.5px solid #44495a;
            border-radius: 0.7rem;
            font-size: 1.08rem;
            padding: 0.9rem 1.1rem;
        }
        .form-control:focus, .form-select:focus {
            background: #22243a;
            color: #fff;
            border-color: #FF6F00;
            box-shadow: 0 0 0 0.15rem rgba(255,111,0,0.15);
        }
        .btn-close-feedback {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            position: absolute;
            top: 1.2rem;
            right: 1.5rem;
            z-index: 10;
        }
        .tags-input-wrapper {
            background: #22243a;
            border: 1.5px solid #44495a;
            border-radius: 0.7rem;
            min-height: 48px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 0.5rem 0.7rem;
            gap: 0.4rem;
            position: relative;
        }
        .tags-input-wrapper input {
            background: transparent;
            min-width: 120px;
            flex: 1 0 120px;
            border: none;
            color: #fff;
            outline: none;
            font-size: 1rem;
            padding: 0.3rem 0;
        }
        .tag {
            display: flex;
            align-items: center;
            background: #FF6F00;
            color: #fff;
            border-radius: 1.2rem;
            padding: 0.35em 0.9em 0.35em 1em;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0.15em 0.15em 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            transition: background 0.2s;
        }
        .tag .remove-tag {
            margin-left: 0.7em;
            cursor: pointer;
            font-size: 1.1em;
            color: #fff;
            opacity: 0.7;
            transition: opacity 0.2s;
            box-shadow: none; /* Remove qualquer sombra */
        }
        .tag .remove-tag:hover {
            opacity: 1;
            color: #22243a;
        }
        .btn-close-feedback:hover {
            opacity: 1;
            color: #919191;
        }
        .bg-dark.border.rounded.shadow-sm.position-absolute {
            background: #181a2a !important;
            border: 1.5px solid #44495a !important;
            color: #fff;
            font-size: 1rem;
        }
        .bg-dark.border.rounded.shadow-sm.position-absolute div:hover {
            background: #FF6F00 !important;
            color: #fff;
        }
        .btn-edit-icon {
            background: none;
            border: none;
            padding: 0.3rem 0.5rem;
            border-radius: 0.5rem;
            color: #FF6F00;
            font-size: 1.3rem;
            transition: background 0.18s, color 0.18s;
            box-shadow: none;
        }
        .btn-edit-icon:hover, .btn-edit-icon:focus {
            background: rgba(255,111,0,0.08);
            color: #ff8c33;
        }
        .btn-edit-icon i {
            color: inherit;
            font-size: 1.3rem;
            vertical-align: middle;
        }
        /* Removidos: .profile-rating, .profile-feedback, .profile-flags, .profile-flags-box, .flag-circle, .flags-text */
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-md sticky-top py-3 navbar-dark" id="mainNav">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <span class="bs-icon-sm bs-icon-circle bs-icon-primary shadow d-flex justify-content-center align-items-center me-2 bs-icon" style="width: 60px;height: 60px;background: #00294B;">
                    <img src="assets/img/Captura_de_tela_2025-05-16_211248-removebg-preview.png" width="54" height="33" style="margin-left: 3px;">
                </span>
            </a>
            <button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-1">
                <span class="visually-hidden">Toggle navigation</span>
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navcol-1">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link" href="/Inicio.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="/contacts.html">FAQ</a></li>
                </ul>
                <a class="btn btn-primary shadow" role="button" href="signup.html">Entrar</a>
            </div>
        </div>
    </nav>
    <main>
        <section class="bg-dark py-5">
            <div class="container">
                <!-- Profile Header -->
                <div class="profile-header mb-4 position-relative">
                    <button class="btn btn-edit-icon edit-btn position-absolute top-0 end-0 m-2" data-edit="header" title="Editar"><i class="bi bi-pencil-square"></i></button>
                </div>
                <!-- SOBRE, EXPERIÊNCIA, CERTIFICADOS -->
                <div class="row">
                    <div class="col-lg-8">
                        <!-- SOBRE -->
                        <div class="profile-section mb-4 position-relative">
                            <button class="btn btn-edit-icon edit-btn position-absolute top-0 end-0 m-2" data-edit="sobre" title="Editar"><i class="bi bi-pencil-square"></i></button>
                            <h4>Sobre</h4>
                            <p id="profileSobre"></p>
                        </div>
                        <!-- HABILIDADES -->
                        <div class="profile-section mb-4 position-relative">
                            <button class="btn btn-edit-icon edit-btn position-absolute top-0 end-0 m-2" data-edit="habilidades" title="Editar"><i class="bi bi-pencil-square"></i></button>
                            <h4>Habilidades</h4>
                            <div class="profile-badges mb-2" id="profileSkills"></div>
                        </div>
                        <!-- EXPERIÊNCIA -->
                        <div class="profile-section mb-4 position-relative">
                            <button class="btn btn-edit-icon edit-btn position-absolute top-0 end-0 m-2" data-edit="experiencia" title="Editar"><i class="bi bi-pencil-square"></i></button>
                            <h4>Experiência Profissional</h4>
                            <div class="profile-timeline" id="profileExperiencia"></div>
                        </div>
                        <!-- CERTIFICADOS -->
                        <div class="profile-section mb-4 profile-certificates position-relative">
                            <button class="btn btn-edit-icon edit-btn position-absolute top-0 end-0 m-2" data-edit="certificados" title="Editar"><i class="bi bi-pencil-square"></i></button>
                            <h4>Certificados</h4>
                            <div id="profileCertificados"></div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <!-- Card de salvar modificações -->
                        <div class="invite-card mb-4">
                            <h5>Salvar Modificações Realizadas</h5>
                            <button id="btnAplicarAlteracoes" class="btn invite-btn w-100 mt-2">
                                <i class="bi bi-check-circle"></i> Aplicar Alterações
                            </button>
                        </div>
                        <!-- Card de conclusão do perfil -->
                        <div class="invite-card mb-4">
                            <h5>Conclusão do perfil</h5>
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span style="color:#fff;font-weight:600;">Progresso</span>
                                <span id="profileProgressPercent" style="color:#FF6F00;font-weight:700;">0%</span>
                            </div>
                            <div class="progress mb-4" style="height: 1.1rem; border-radius:0.7rem;">
                                <div id="profileProgressBar" class="progress-bar bg-warning" role="progressbar" style="width: 0%; font-weight:700; color:#22243a;">
                                    0%
                                </div>
                            </div>
                            <ul id="profileMissingFields" class="mt-3 mb-0" style="color:#ff4d4f; font-size:1rem; list-style:disc inside;"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="bg-dark mt-5">
        <div class="container py-4 py-lg-5">
            <div class="row justify-content-center">
                <div class="col-sm-4 col-md-3 text-center text-lg-start d-flex flex-column">
                    <h3 class="fs-6 fw-bold">Dúvidas</h3>
                    <ul class="list-unstyled">
                        <li>FAQ</li>
                        <li><a href="#">Central de ajuda</a></li>
                        <li>Política de privacidade</li>
                    </ul>
                </div>
                <div class="col-sm-4 col-md-3 text-center text-lg-start d-flex flex-column">
                    <h3 class="fs-6 fw-bold">Sobre</h3>
                    <ul class="list-unstyled">
                        <li><a href="#">Publique seu projeto</a></li>
                        <li><a href="#">Cadastro</a></li>
                        <li><a href="#">Lista de freelancers</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 text-center text-lg-start d-flex flex-column align-items-center order-first align-items-lg-start order-lg-last">
                    <div class="fw-bold d-flex align-items-center mb-2">
                        <span class="bs-icon-sm bs-icon-circle bs-icon-primary shadow d-flex justify-content-center align-items-center me-2 bs-icon" style="width: 40px;height: 40px;background: #00294B;">
                            <img src="assets/img/Captura_de_tela_2025-05-16_211248-removebg-preview.png" width="30" height="23" style="height: 18px;">
                        </span>
                        <span>TechFree</span>
                    </div>
                    <p class="text-muted">Feito com muito amor e dedicação por alunos da Fatec Carapicuíba!❤️</p>
                </div>
            </div>
            <hr>
            <div class="text-muted d-flex justify-content-between align-items-center pt-3">
                <p class="mb-0">Copyright © 2025 TechFree</p>
                <ul class="list-inline mb-0">
                    <li class="list-inline-item"><i class="bi bi-github"></i></li>
                    <li class="list-inline-item"><i class="bi bi-twitter"></i></li>
                    <li class="list-inline-item"><i class="bi bi-instagram"></i></li>
                </ul>
            </div>
        </div>
    </footer>
    <!-- POPUP DE EDIÇÃO (reutilizável para todos os cards) -->
    <div class="feedback-overlay" id="editOverlay"></div>
    <div id="editPopup" class="feedback-form-card" style="display:none; position:fixed;">
        <button class="btn-close-feedback" id="closeEditPopup" type="button" title="Fechar">&times;</button>
        <h4 class="mb-4" id="editPopupTitle">Editar</h4>
        <form id="editForm" autocomplete="off">
            <div id="editFormFields"></div>
            <button type="submit" class="btn btn-secondary w-50 d-block mx-auto" style="font-weight:700; font-size:1.1rem; padding:0.7rem 0; border-radius:0.7rem; margin-top:0.5rem;">Salvar</button>
        </form>
    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script>
const profileData = {
    nome: "Lucas Silva",
    avatar: "https://randomuser.me/api/portraits/men/32.jpg",
    cargo: "Desenvolvedor Full Stack",
    contato: {
        email: "lucas@email.com",
        whatsapp: "(11) 99999-9999"
    },
    redes: [
        { icon: "bi-github", link: "#" },
        { icon: "bi-linkedin", link: "#" },
        { icon: "bi-globe", link: "#" }
    ],
    habilidades: ["React", "Node.js", "MongoDB", "JavaScript", "TypeScript", "Express", "Docker", "Figma", "Scrum", "Inglês Avançado"],
    certificados: [
        "AWS Certified Developer",
        "Scrum Foundation",
        "Inglês Avançado"
    ],
    sobre: "Sou um desenvolvedor apaixonado por tecnologia, com experiência em projetos web e mobile. Gosto de trabalhar em equipe, aprender novas ferramentas e entregar soluções inovadoras. Busco sempre evoluir e contribuir para o sucesso dos projetos em que participo.",
    experiencia: [
        {
            empresa: "TechFree",
            cargo: "Desenvolvedor Full Stack",
            tempo: "2024-2025",
            descricao: "Desenvolvimento full stack, integração de APIs e liderança técnica."
        },
        {
            empresa: "MindCare",
            cargo: "Desenvolvedor Mobile",
            tempo: "2023-2024",
            descricao: "Desenvolvimento mobile com Flutter, gamificação e notificações."
        },
        {
            empresa: "LogiTech",
            cargo: "Desenvolvedor Frontend",
            tempo: "2022-2023",
            descricao: "Criação de dashboards, relatórios e integração mobile."
        }
    ]
};

// Sugestões para habilidades e certificados (adicione mais se quiser)
const sugestoesHabilidades = [
    "JavaScript", "Python", "Java", "C#", "PHP", "SQL", "React", "Node.js", "TypeScript", "Vue.js", "Angular", "Docker", "Figma", "Scrum", "Inglês Avançado"
];
const sugestoesCertificados = [
    "AWS Certified Developer", "Scrum Foundation", "Inglês Avançado", "Google Cloud", "Azure Fundamentals"
];

// Função para criar sistema de tags
function setupTagsInput(wrapperId, initialTags, suggestions) {
    const wrapper = document.getElementById(wrapperId);
    wrapper.innerHTML = `
        <div class="tags-input-wrapper" style="background: #22243a; border: 1.5px solid #44495a; border-radius: 0.7rem; min-height: 48px; display: flex; flex-wrap: wrap; align-items: center; padding: 0.5rem 0.7rem;">
            <input type="text" class="form-control border-0 shadow-none p-0 m-0" style="background: transparent; min-width: 120px; flex: 1 0 120px;" placeholder="Digite e pressione Enter..." autocomplete="off">
            <div class="bg-dark border rounded shadow-sm position-absolute w-100 mt-1" style="z-index: 10; display: none; max-height: 220px; overflow-y: auto; left: 0; top: 100%;"></div>
        </div>
    `;
    const tagsInputWrapper = wrapper.querySelector('.tags-input-wrapper');
    const input = tagsInputWrapper.querySelector('input');
    const dropdown = tagsInputWrapper.querySelector('div');
    let tags = [...initialTags];

    function renderTags() {
        // Remove todas as tags visuais antes de renderizar
        tagsInputWrapper.querySelectorAll('.tag').forEach(el => el.remove());
        tags.forEach(tag => {
            const tagEl = document.createElement('span');
            tagEl.className = 'tag';
            tagEl.textContent = tag;
            const removeBtn = document.createElement('span');
            removeBtn.className = 'remove-tag';
            removeBtn.innerHTML = '&times;';
            removeBtn.onclick = function () {
                tags = tags.filter(t => t !== tag);
                renderTags();
            };
            tagEl.appendChild(removeBtn);
            tagsInputWrapper.insertBefore(tagEl, input);
        });
    }

    function renderDropdown(filter = "") {
        dropdown.innerHTML = "";
        let filtered = suggestions.filter(s => s.toLowerCase().includes(filter.toLowerCase()) && !tags.includes(s));
        if (filter && !suggestions.map(s=>s.toLowerCase()).includes(filter.toLowerCase()) && !tags.includes(filter)) {
            filtered.unshift(filter);
        }
        if (filtered.length === 0) {
            dropdown.style.display = "none";
            return;
        }
        filtered.forEach(opt => {
            const div = document.createElement('div');
            div.className = "px-3 py-2";
            div.style.cursor = "pointer";
            div.textContent = opt;
            div.onclick = function() {
                if (!tags.includes(opt)) {
                    tags.push(opt);
                    renderTags();
                }
                dropdown.style.display = "none";
                input.value = "";
                input.focus();
            };
            dropdown.appendChild(div);
        });
        dropdown.style.display = "block";
    }

    input.addEventListener('input', function () {
        renderDropdown(this.value.trim());
    });
    input.addEventListener('focus', function () {
        renderDropdown(this.value.trim());
    });
    input.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            let val = this.value.trim();
            if (val && !tags.includes(val)) {
                tags.push(val);
                renderTags();
            }
            this.value = "";
            dropdown.style.display = "none";
        }
    });
    document.addEventListener('click', function(e) {
        if (!input.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.style.display = "none";
        }
    });

    // Inicializa com as tags existentes
    renderTags();

    // Função para pegar as tags atuais (para salvar depois)
    return () => tags;
}

function renderProfile(profile) {
    // Certificados
    let certificadosHtml = profile.certificados.map(cert => `<span class="badge">${cert}</span>`).join('');

    // Habilidades (mostra só as principais no header, o resto na seção)
    let headerSkills = profile.habilidades.slice(0, 3).map(h => `<span class="badge">${h}</span>`).join('');
    let allSkills = profile.habilidades.map(h => `<span class="badge">${h}</span>`).join('');

    // Redes sociais
    let redesHtml = profile.redes.map(r => `<a href="${r.link}" target="_blank" rel="noopener noreferrer"><i class="bi ${r.icon}"></i></a>`).join('');

    // Contato
    let contatoHtml = `
        <div><i class="bi bi-envelope"></i><span>${profile.contato.email}</span></div>
        <div><i class="bi bi-whatsapp"></i><span>${profile.contato.whatsapp}</span></div>
    `;

    // Experiência Profissional
    let experienciaHtml = profile.experiencia.map((exp, idx) => `
        <div class="timeline-item" data-exp-idx="${idx}">
            <div class="timeline-title">${exp.empresa}</div>
            <div class="timeline-period">${exp.cargo} (${exp.tempo})</div>
            <div>${exp.descricao}</div>
        </div>
    `).join('');

    // Monta o HTML
    document.querySelector('.profile-header').innerHTML = `
        <button class="btn btn-edit-icon edit-btn position-absolute top-0 end-0 m-2" data-edit="header" title="Editar"><i class="bi bi-pencil-square"></i></button>
        <img src="${profile.avatar}" class="profile-avatar" alt="Avatar do Usuário">
        <div class="profile-info flex-grow-1">
            <h2>${profile.nome}</h2>
            <div class="role mb-1">${profile.cargo}</div>
            <div class="profile-badges mb-2">${headerSkills}</div>
            <div class="profile-contact mt-2">${contatoHtml}</div>
            <div class="profile-social mt-3">${redesHtml}</div>
        </div>
    `;

    // Sobre
    document.getElementById('profileSobre').innerHTML = profile.sobre;

    // Habilidades
    document.getElementById('profileSkills').innerHTML = allSkills;

    // Experiência
    document.getElementById('profileExperiencia').innerHTML = experienciaHtml;

    // Certificados
    document.getElementById('profileCertificados').innerHTML = certificadosHtml;

    // Atualiza barra de progresso
    atualizarBarraProgresso(profile);
}

document.addEventListener('DOMContentLoaded', function() {
    renderProfile(profileData);

    function getPopupElements() {
        return {
            overlay: document.getElementById('editOverlay'),
            popup: document.getElementById('editPopup'),
            closeBtn: document.getElementById('closeEditPopup'),
            title: document.getElementById('editPopupTitle'),
            fields: document.getElementById('editFormFields')
        };
    }

    // Função para preencher o popup com as informações do card
    function fillPopup(type) {
        const { title, fields } = getPopupElements();
        let html = '';
        switch(type) {
            case 'header':
                title.textContent = 'Editar Resumo';
                html = `
                    <div class="mb-3 text-center">
                        <img src="${profileData.avatar}" id="avatarPreview" class="rounded-circle mb-2" style="width:90px;height:90px;object-fit:cover;border:3px solid #FF6F00;background:#fff;">
                        <div>
                            <label class="form-label d-block">Avatar</label>
                            <input type="file" class="form-control mb-2" id="avatarInput" accept="image/*">
                            <input type="hidden" id="avatarUrlInput" value="${profileData.avatar}">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Nome</label>
                        <input type="text" class="form-control" id="editNome" value="${profileData.nome}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Cargo</label>
                        <input type="text" class="form-control" id="editCargo" value="${profileData.cargo}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contatos</label>
                        <div class="mb-2">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                                <input type="text" class="form-control" id="editEmail" placeholder="E-mail de contato" value="${profileData.contato.email || ''}">
                            </div>
                            <div id="editEmailError" class="text-danger mt-1" style="font-size:0.98rem;"></div>
                        </div>
                        <div class="mb-2">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-whatsapp"></i></span>
                                <input type="text" class="form-control" id="editWhatsapp" placeholder="Telefone/WhatsApp" value="${profileData.contato.whatsapp || ''}">
                            </div>
                            <div id="editWhatsappError" class="text-danger mt-1" style="font-size:0.98rem;"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Redes Sociais</label>
                        <div id="redesInputs">
                            <div class="mb-2">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-github"></i></span>
                                    <input type="text" class="form-control" id="editGithub" placeholder="GitHub URL" value="${profileData.redes[0]?.link || ''}">
                                </div>
                                <div id="editGithubError" class="text-danger mt-1" style="font-size:0.98rem;"></div>
                            </div>
                            <div class="mb-2">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-linkedin"></i></span>
                                    <input type="text" class="form-control" id="editLinkedin" placeholder="LinkedIn URL" value="${profileData.redes[1]?.link || ''}">
                                </div>
                                <div id="editLinkedinError" class="text-danger mt-1" style="font-size:0.98rem;"></div>
                            </div>
                            <div class="mb-2">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-globe"></i></span>
                                    <input type="text" class="form-control" id="editSite" placeholder="Site URL" value="${profileData.redes[2]?.link || ''}">
                                </div>
                                <div id="editSiteError" class="text-danger mt-1" style="font-size:0.98rem;"></div>
                            </div>
                        </div>
                    </div>
                `;
                break;
            case 'sobre':
                title.textContent = 'Editar Sobre';
                html = `
                    <div class="mb-3">
                        <label class="form-label">Sobre</label>
                        <textarea class="form-control" id="editSobre" rows="5">${profileData.sobre}</textarea>
                    </div>
                `;
                break;
            case 'habilidades':
                title.textContent = 'Editar Habilidades';
                html = `
                    <div class="mb-3">
                        <label class="form-label">Habilidades</label>
                        <div id="tagsHabilidades"></div>
                    </div>
                `;
                break;
            case 'certificados':
                title.textContent = 'Editar Certificados';
                html = `
                    <div class="mb-3">
                        <label class="form-label">Certificados</label>
                        <div id="tagsCertificados"></div>
                    </div>
                `;
                break;
            case 'experiencia':
                title.textContent = 'Editar Experiência';
                html = profileData.experiencia.map((exp, idx) => {
                    let [anoInicio, anoFim] = (exp.tempo || '').split('-');
                    const anoAtual = new Date().getFullYear();
                    return `
                    <div class="mb-3 border rounded p-2" id="exp-card-${idx}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="timeline-title" style="font-weight:700;color:#FF6F00;">${exp.empresa}</div>
                                <div class="timeline-period" style="font-size:0.95rem;color:#bdbdbd;">${exp.cargo} (${exp.tempo})</div>
                                <div>${exp.descricao}</div>
                            </div>
                            <div class="d-flex align-items-center gap-1">
                                <button type="button" class="btn btn-edit-icon btn-exp-edit" data-idx="${idx}" title="Editar"><i class="bi bi-pencil-square"></i></button>
                                <button type="button" class="btn btn-edit-icon btn-exp-remove" data-idx="${idx}" title="Excluir"><i class="bi bi-trash"></i></button>
                            </div>
                        </div>
                        <div class="exp-edit-fields mt-3" style="display:none;">
                            <label class="form-label">Empresa</label>
                            <input type="text" class="form-control mb-1" value="${exp.empresa}">
                            <label class="form-label">Cargo</label>
                            <input type="text" class="form-control mb-1" value="${exp.cargo}">
                            <label class="form-label">Tempo</label>
                            <div class="d-flex gap-2 align-items-center mb-1 flex-wrap">
                                <input type="number" class="form-control" style="max-width:100px;" min="1900" max="${anoAtual}" placeholder="Ano início" value="${anoInicio || ''}">
                                <span style="color:#fff;">até</span>
                                <input type="number" class="form-control" style="max-width:100px;" min="1900" max="${anoAtual}" placeholder="Ano fim" value="${anoFim || ''}">
                            </div>
                            <label class="form-label">Descrição</label>
                            <textarea class="form-control" rows="2">${exp.descricao}</textarea>
                            <button type="button" class="btn btn-success mt-2 btn-exp-save" data-idx="${idx}" style="min-width:120px;"><i class="bi bi-check"></i> Salvar</button>
                        </div>
                    </div>
                    `;
                }).join('');

                // Coloque o bloco de nova experiência ACIMA do botão de adicionar experiência
                html += `
                <div id="exp-add-card" style="display:none;">
                    <div class="mb-3 border rounded p-3 bg-dark">
                        <div class="fw-bold mb-2" style="color:#FF6F00;">Nova experiência</div>
                        <label class="form-label">Empresa</label>
                        <input type="text" class="form-control mb-1" id="expAddEmpresa">
                        <label class="form-label">Cargo</label>
                        <input type="text" class="form-control mb-1" id="expAddCargo">
                        <label class="form-label">Tempo</label>
                        <div class="d-flex gap-2 align-items-center mb-1 flex-wrap">
                            <input type="number" class="form-control" style="max-width:100px;" min="1900" max="${new Date().getFullYear()}" placeholder="Início" id="expAddAnoInicio">
                            <span style="color:#fff;">até</span>
                            <input type="number" class="form-control" style="max-width:100px;" min="1900" max="${new Date().getFullYear()}" placeholder="Fim" id="expAddAnoFim">
                        </div>
                        <label class="form-label">Descrição</label>
                        <textarea class="form-control" rows="2" id="expAddDescricao"></textarea>
                        <div class="d-flex gap-2 mt-3">
                            <button type="button" class="btn btn-primary flex-fill" id="btnAddExp"><i class="bi bi-check-lg"></i> Adicionar</button>
                            <button type="button" class="btn btn-outline-secondary flex-fill" id="btnCancelAddExp">Cancelar</button>
                        </div>
                        <div id="expAddError" class="text-danger mt-2" style="display:none;font-size:0.98rem;"></div>
                    </div>
                </div>
                <div class="mb-3" id="exp-add-btn-wrapper">
                    <button type="button" class="btn btn-success w-100" id="btnShowAddExp" style="font-weight:600;">
                        <i class="bi bi-plus-lg"></i> Adicionar experiência
                    </button>
                </div>
                `;
                break;
            default:
                title.textContent = 'Editar';
                html = '';
        }
        fields.innerHTML = html;

        // Avatar preview ao selecionar arquivo
        if(type === 'header') {
            const avatarInput = document.getElementById('avatarInput');
            const avatarPreview = document.getElementById('avatarPreview');
            const avatarUrlInput = document.getElementById('avatarUrlInput');
            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = function(ev) {
                        avatarPreview.src = ev.target.result;
                        avatarUrlInput.value = ev.target.result; // Salva a imagem em base64
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        if(type === 'habilidades') {
            window.getHabilidadesTags = setupTagsInput('tagsHabilidades', profileData.habilidades, sugestoesHabilidades);
        }
        if(type === 'certificados') {
            window.getCertificadosTags = setupTagsInput('tagsCertificados', profileData.certificados, sugestoesCertificados);
        }
        if(type === 'experiencia') {
            // Expandir edição
            document.querySelectorAll('.btn-exp-edit').forEach(btn => {
                btn.onclick = function() {
                    const idx = btn.getAttribute('data-idx');
                    const card = document.getElementById(`exp-card-${idx}`);
                    const fields = card.querySelector('.exp-edit-fields');
                    fields.style.display = fields.style.display === 'none' ? 'block' : 'none';
                };
            });
            // Excluir experiência
            document.querySelectorAll('.btn-exp-remove').forEach(btn => {
                btn.onclick = function() {
                    const idx = btn.getAttribute('data-idx');
                    profileData.experiencia.splice(idx, 1);
                    fillPopup('experiencia');
                };
            });
            // Salvar experiência editada
            document.querySelectorAll('.btn-exp-save').forEach(btn => {
                btn.onclick = function() {
                    const idx = btn.getAttribute('data-idx');
                    const card = document.getElementById(`exp-card-${idx}`);
                    const inputs = card.querySelectorAll('input');
                    const textarea = card.querySelector('textarea');
                    const empresa = inputs[0].value;
                    const cargo = inputs[1].value;
                    const anoInicio = inputs[2].value;
                    const anoFim = inputs[3].value;
                    const tempo = anoInicio && anoFim ? `${anoInicio}-${anoFim}` : '';
                    const descricao = textarea.value;
                    profileData.experiencia[idx] = { empresa, cargo, tempo, descricao };
                    fillPopup('experiencia');
                };
            });

            // Adicionar nova experiência (expandir/cancelar/adicionar)
            const btnShowAddExp = document.getElementById('btnShowAddExp');
            const expAddCard = document.getElementById('exp-add-card');
            if(btnShowAddExp && expAddCard) {
                btnShowAddExp.onclick = function() {
                    expAddCard.style.display = 'block';
                    btnShowAddExp.disabled = true;
                };
            }
            const btnCancelAddExp = document.getElementById('btnCancelAddExp');
            if(btnCancelAddExp && expAddCard && btnShowAddExp) {
                btnCancelAddExp.onclick = function() {
                    expAddCard.style.display = 'none';
                    btnShowAddExp.disabled = false;
                };
            }
            const btnAddExp = document.getElementById('btnAddExp');
            if(btnAddExp) {
                btnAddExp.onclick = function() {
                    const empresa = document.getElementById('expAddEmpresa').value.trim();
                    const cargo = document.getElementById('expAddCargo').value.trim();
                    const anoInicio = document.getElementById('expAddAnoInicio').value.trim();
                    const anoFim = document.getElementById('expAddAnoFim').value.trim();
                    const descricao = document.getElementById('expAddDescricao').value.trim();
                    const errorDiv = document.getElementById('expAddError');
                    if(!empresa || !cargo || !anoInicio || !anoFim || !descricao) {
                        errorDiv.textContent = "Preencha todos os campos para adicionar uma experiência.";
                        errorDiv.style.display = "block";
                        return;
                    }
                    errorDiv.style.display = "none";
                    profileData.experiencia.push({
                        empresa,
                        cargo,
                        tempo: `${anoInicio}-${anoFim}`,
                        descricao
                    });
                    fillPopup('experiencia');
                };
            }
        }
        // Dentro da função fillPopup(type), após inserir os campos no DOM:
        if(type === 'header') {
            // ...código existente para montar html...
            // Após fields.innerHTML = html;
            setTimeout(() => {
                const whatsappInput = document.getElementById('editWhatsapp');
                if (whatsappInput) aplicarMascaraTelefone(whatsappInput);
            }, 0);
        }
    }

    // Abrir popup ao clicar em qualquer botão de edição
    document.body.addEventListener('click', function(e) {
        const btn = e.target.closest('.edit-btn');
        if (btn) {
            const { overlay, popup } = getPopupElements();
            const type = btn.getAttribute('data-edit');
            fillPopup(type);
            overlay.classList.add('active');
            popup.classList.add('active');
            popup.style.display = 'block';
        }
    });

    function closeOverlay() {
        const { overlay, popup } = getPopupElements();
        overlay.classList.remove('active');
        popup.classList.remove('active');
        setTimeout(() => { popup.style.display = 'none'; }, 200);
    }
    getPopupElements().overlay.onclick = closeOverlay;
    getPopupElements().closeBtn.onclick = closeOverlay;

    // Salvar alterações ao enviar o formulário
    document.getElementById('editForm').onsubmit = function(e) {
        e.preventDefault();
        const type = document.getElementById('editPopupTitle').textContent.replace('Editar ', '').toLowerCase();

        if(type === 'resumo' || type === 'cabeçalho' || type === 'cabecalho' || type === 'header') {
            // Pega valores
            const nome = document.getElementById('editNome').value.trim();
            const cargo = document.getElementById('editCargo').value.trim();
            const avatar = document.getElementById('avatarUrlInput').value;
            const email = document.getElementById('editEmail').value.trim();
            const whatsapp = document.getElementById('editWhatsapp').value.trim();
            const github = document.getElementById('editGithub').value.trim();
            const linkedin = document.getElementById('editLinkedin').value.trim();
            const site = document.getElementById('editSite').value.trim();

            // Regex simples para validação
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const telRegex = /^\+?\d{8,11}$/;
            const urlRegex = /^(https?:\/\/)?([\w\-]+\.)+[\w\-]+(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)?$/i;

            // Limpa mensagens antigas
            function setError(id, msg) {
                let el = document.getElementById(id);
                if (!el) {
                    const input = document.getElementById(id.replace('Error',''));
                    el = document.createElement('div');
                    el.id = id;
                    el.className = 'text-danger mt-1';
                    input.parentNode.appendChild(el);
                }
                el.innerHTML = msg || '';
                el.style.display = msg ? 'block' : 'none';
            }
            setError('editEmailError', '');
            setError('editWhatsappError', '');
            setError('editGithubError', '');
            setError('editLinkedinError', '');
            setError('editSiteError', '');

            // Mensagem de erro por campo
            let hasError = false;
            if(email && !emailRegex.test(email)) {
                setError('editEmailError', 'E-mail inválido.');
                hasError = true;
            }
            if(whatsapp && !telRegex.test(whatsapp.replace(/\D/g, ''))) {
                setError('editWhatsappError', 'Telefone/WhatsApp inválido.');
                hasError = true;
            }
            if(github && github !== "#" && !urlRegex.test(github)) {
                setError('editGithubError', 'GitHub URL inválido.');
                hasError = true;
            }
            if(linkedin && linkedin !== "#" && !urlRegex.test(linkedin)) {
                setError('editLinkedinError', 'LinkedIn URL inválido.');
                hasError = true;
            }
            if(site && site !== "#" && !urlRegex.test(site)) {
                setError('editSiteError', 'Site URL inválido.');
                hasError = true;
            }
            if(hasError) return false;

            // Salva se passou na validação
            profileData.nome = nome;
            profileData.cargo = cargo;
            profileData.avatar = avatar;
            profileData.contato.email = email;
            profileData.contato.whatsapp = whatsapp;
            profileData.redes[0].link = github;
            profileData.redes[1].link = linkedin;
            profileData.redes[2].link = site;
        }
        if(type === 'sobre') {
            profileData.sobre = document.getElementById('editSobre').value.trim();
        }
        if(type === 'habilidades') {
            if(window.getHabilidadesTags) {
                profileData.habilidades = window.getHabilidadesTags();
            }
        }
        if(type === 'certificados') {
            if(window.getCertificadosTags) {
                profileData.certificados = window.getCertificadosTags();
            }
        }
        // Experiência é salva individualmente nos botões de salvar de cada experiência
        renderProfile(profileData);
        closeOverlay();
        return false;
    };
});
</script>
<script>
function aplicarMascaraTelefone(input) {
    input.addEventListener('input', function() {
        let v = input.value.replace(/\D/g, '');
        if (v.length > 11) v = v.slice(0, 11);
        if (v.length > 0) v = '(' + v;
        if (v.length > 3) v = v.slice(0, 3) + ') ' + v.slice(3);
        if (v.length > 10) v = v.slice(0, 10) + '-' + v.slice(10);
        else if (v.length > 6) v = v.slice(0, 9) + (v.length > 6 ? '-' + v.slice(9) : '');
        // Remove o hífen se não houver números depois dele
        if (v.endsWith('-')) v = v.slice(0, -1);
        input.value = v;
    });
}

// Atualize a função calcularProgressoPerfil para considerar links de redes sociais:
function calcularProgressoPerfil(profile) {
    // Considera links de redes sociais como obrigatórios
    const redes = profile.redes || [];
    const github = redes[0]?.link || "";
    const linkedin = redes[1]?.link || "";
    const site = redes[2]?.link || "";

    const campos = [
        { nome: "Foto", valor: profile.avatar },
        { nome: "Nome", valor: profile.nome },
        { nome: "Cargo", valor: profile.cargo },
        { nome: "E-mail", valor: profile.contato.email },
        { nome: "Telefone/WhatsApp", valor: profile.contato.whatsapp },
        { nome: "GitHub", valor: github },
        { nome: "LinkedIn", valor: linkedin },
        { nome: "Site", valor: site },
        { nome: "Sobre", valor: profile.sobre },
        { nome: "Habilidades", valor: (profile.habilidades && profile.habilidades.length > 0) ? "ok" : "" },
        { nome: "Certificados", valor: (profile.certificados && profile.certificados.length > 0) ? "ok" : "" },
        { nome: "Experiência Profissional", valor: (profile.experiencia && profile.experiencia.length > 0) ? "ok" : "" }
    ];
    const total = campos.length;
    const preenchidos = campos.filter(c => c.valor && String(c.valor).trim() !== "").length;
    const faltando = campos.filter(c => !c.valor || String(c.valor).trim() === "").map(c => c.nome);
    const porcentagem = Math.round((preenchidos / total) * 100);
    return { porcentagem, faltando };
}

function atualizarBarraProgresso(profile) {
    const { porcentagem, faltando } = calcularProgressoPerfil(profile);
    const bar = document.getElementById('profileProgressBar');
    const percent = document.getElementById('profileProgressPercent');
    const missing = document.getElementById('profileMissingFields');
    if(bar && percent) {
        bar.style.width = porcentagem + "%";
        bar.textContent = porcentagem + "%";
        percent.textContent = porcentagem + "%";
    }
    if(missing) {
        if(faltando.length === 0) {
            missing.innerHTML = `<li style="color:#28a745;">Tudo preenchido! 🎉</li>`;
        } else {
            // Adiciona anúncio antes da lista
            missing.innerHTML = `<div class="mb-2" style="color:#fff;font-weight:600;margin-left:-2rem;">Itens ainda não preenchidos:</div>` +
                faltando.map(f => `<li>${f}</li>`).join('');
        }
    }
}

// Chame sempre que renderizar o perfil ou salvar alterações:
document.addEventListener('DOMContentLoaded', function() {
    atualizarBarraProgresso(profileData);
    // Se você já chama renderProfile(profileData) em outros lugares, adicione também:
    // atualizarBarraProgresso(profileData);
});

// Se quiser atualizar ao salvar alterações:
function renderProfile(profile) {
    // Certificados
    let certificadosHtml = profile.certificados.map(cert => `<span class="badge">${cert}</span>`).join('');

    // Habilidades (mostra só as principais no header, o resto na seção)
    let headerSkills = profile.habilidades.slice(0, 3).map(h => `<span class="badge">${h}</span>`).join('');
    let allSkills = profile.habilidades.map(h => `<span class="badge">${h}</span>`).join('');

    // Redes sociais
    let redesHtml = profile.redes.map(r => `<a href="${r.link}" target="_blank" rel="noopener noreferrer"><i class="bi ${r.icon}"></i></a>`).join('');

    // Contato
    let contatoHtml = `
        <div><i class="bi bi-envelope"></i><span>${profile.contato.email}</span></div>
        <div><i class="bi bi-whatsapp"></i><span>${profile.contato.whatsapp}</span></div>
    `;

    // Experiência Profissional
    let experienciaHtml = profile.experiencia.map((exp, idx) => `
        <div class="timeline-item" data-exp-idx="${idx}">
            <div class="timeline-title">${exp.empresa}</div>
            <div class="timeline-period">${exp.cargo} (${exp.tempo})</div>
            <div>${exp.descricao}</div>
        </div>
    `).join('');

    // Monta o HTML
    document.querySelector('.profile-header').innerHTML = `
        <button class="btn btn-edit-icon edit-btn position-absolute top-0 end-0 m-2" data-edit="header" title="Editar"><i class="bi bi-pencil-square"></i></button>
        <img src="${profile.avatar}" class="profile-avatar" alt="Avatar do Usuário">
        <div class="profile-info flex-grow-1">
            <h2>${profile.nome}</h2>
            <div class="role mb-1">${profile.cargo}</div>
            <div class="profile-badges mb-2">${headerSkills}</div>
            <div class="profile-contact mt-2">${contatoHtml}</div>
            <div class="profile-social mt-3">${redesHtml}</div>
        </div>
    `;

    // Sobre
    document.getElementById('profileSobre').innerHTML = profile.sobre;

    // Habilidades
    document.getElementById('profileSkills').innerHTML = allSkills;

    // Experiência
    document.getElementById('profileExperiencia').innerHTML = experienciaHtml;

    // Certificados
    document.getElementById('profileCertificados').innerHTML = certificadosHtml;

    // Atualiza barra de progresso
    atualizarBarraProgresso(profile);
}
</script>